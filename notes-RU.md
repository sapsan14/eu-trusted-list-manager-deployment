# Заметки

## Выбор версии Linux для Trusted List Manager

**Официально (ЕК):** В плане указан **официальный стек ЕК** — **Debian 12** + OpenJDK 1.8 + Tomcat 9.0.102 + MySQL 8.0.41. То есть в документации ЕК зафиксирована именно эта ОС.

**Наш план:** Целевая ОС — **дистрибутив RHEL** (Rocky Linux 9 / AlmaLinux 9 / RHEL 9) как корпоративный стандарт (предпочтение Bart).

**Как определяем выбор:**

1. **Источник истины** — **EC Service Manual (PDF)** лежит в репо: `docs/TL-Manager(ServiceOfferingDescription) (v0.03).pdf`. **Проверено:** это Service Offering Description (SOD) — назначение, пользователи (TLSO/LOTLSO), объём, роли, доступ (EC-TL-Service@ec.europa.eu, EU Login UID), использование. **ОС и стек (Java/Tomcat/MySQL) в нём не указаны.** Стек из плана §5 (Debian 12, OpenJDK 1.8, Tomcat 9.0.102, MySQL 8.0.41) взят из пакета развёртывания или другого технического документа ЕК.
2. **Что реально важно для приложения** — не дистрибутив сам по себе, а **стек**: Java 8, Tomcat 9, MySQL 8. Они стандартны и есть на RHEL 9.
3. **Риск в плане (§7):** «TL Manager несовместим с RHEL/MySQL 8 / Tomcat 9.0.x» — **смягчение** уже заложено: при проблемах сначала проверить на **Debian 12 в контейнере** (Podman), чтобы понять, ОС это или нет.

**Рекомендация:**

- **Основной вариант:** использовать **корпоративный RHEL (или Rocky 9 / Alma 9)** — совпадает с Bart и планом; те же версии стека доступны; одна платформа для автоматизации и поддержки.
- **Проверить «исходные требования»:** когда будет пакет, открыть **EC Service Manual** и посмотреть раздел о поддерживаемой/тестируемой платформе; если там только Debian — считать это официально рекомендуемой средой, но не жёстким ограничением при совпадении версий Java/Tomcat/MySQL.
- **Если на RHEL что-то ломается:** по плану — развернуть тот же стек на **Debian 12 в Podman** и сравнить; если на Debian работает, а на RHEL нет — зафиксировать как проблему совместимости с RHEL и либо поправить конфиг/окружение на RHEL, либо принять Debian в контейнере как поддерживаемую конфигурацию.

**Итог:** Версию Linux определяем по (1) тому, что указано в EC Service Manual (официальные требования), и (2) корпоративному стандарту (RHEL). **Выбор: начинать с дистрибутива RHEL; при проблемах совместимости — проверить на Debian 12 в контейнере и зафиксировать результат в оценке готовности к продакшену.**

## Подпись (TL Manager)

TL Manager **может подписывать**, но в лабораторной установке используется **минимальный JKS‑keystore**, чтобы UI стартовал. Для продакшена это не подходит — нужен **QSCD** или утвержденные продукционные ключи.

### Где это описано в репо
- `docs/TL-Manager-Non-EU-Deployment.md` — раздел **Signer keystore**: зачем нужен keystore, как Ansible его создает в лабе, и что для продакшена нужно заменить keystore на реальный.
- `ansible/roles/tlmanager/defaults/main.yml` — переменные keystore (`tlmanager_signer_keystore_path`, `tlmanager_signer_keystore_password`, `tlmanager_signer_keystore_create`).
- `docs/Production-Adjustments.md` — раздел **Signing keys (QSCD)**: требования к продакшен‑ключам и их управлению.

### Что нужно подготовить для production‑подписи (минимум)
- **QSCD или утвержденный ключевой материал** (не лабораторный JKS).
- Обновить переменные:
  - `tlmanager_signer_keystore_path` — путь к реальному keystore
  - `tlmanager_signer_keystore_password` — реальный пароль
  - `tlmanager_signer_keystore_create: false` — чтобы Ansible не создавал лабовый JKS
- Обеспечить **хранение/доступ** (права tomcat, бэкапы, ротация, доступ по политикам).
- Занести пароли в **vault** и убрать plaintext из `group_vars`.

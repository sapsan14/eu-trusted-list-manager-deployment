# Trusted List Manager (EU OSS) — План развёртывания

**Владелец:** Антон Соколов  
**Заинтересованная сторона:** Bart / ZetesConfidens Trust Services  
**Единственный источник истины:** брифинг Bart (см. §1)  
**Статус:** Черновик — детальный план с оценкой сроков, рисками, заказом ресурсов и автоматизацией  
**Целевая платформа:** Red Hat Linux (корпоративный стандарт) или дистрибутив RHEL; ВМ или Podman

> **Примечание по названию:** План касается **Trusted List Manager** (веб-приложение для просмотра, редактирования и мониторинга доверенных списков), а не «генератора». Еврокомиссия также предоставляет отдельный **Trusted List Signing Tool** (локальное подписание); он вторичен по охвату.

**Текущий статус:** Пакет TL Manager **TL-NEU-6.0.ZIP** доступен в этом проекте в каталоге **`packages/`**. Установка RHEL 9 на лабораторную ВМ в процессе.

---

# Содержание

- [1. Источник истины — объём и задача (Bart)](#1-источник-истины--объём-и-задача-bart)
- [2. Инструменты в рамках проекта](#2-инструменты-в-рамках-проекта)
- [3. Предусловия и блокеры](#3-предусловия-и-блокеры)
- [4. Заказ и поставка ресурсов](#4-заказ-и-поставка-ресурсов)
- [5. Окружение и стек](#5-окружение-и-стек)
- [6. Детальный план с оценкой сроков](#6-детальный-план-с-оценкой-сроков)
- [7. Риски и меры по снижению](#7-риски-и-меры-по-снижению)
- [8. Конкретные шаги (чек-лист)](#8-конкретные-шаги-чек-лист)
- [9. Автоматизация где возможно](#9-автоматизация-где-возможно)
- [10. Промпты для LLM](#10-промпты-для-llm)
- [11. Оценка готовности к продакшену](#11-оценка-готовности-к-продакшену)
- [12. Перспектива: после PoC и масштабирование](#12-перспектива-после-poc-и-масштабирование)
- [13. Ссылки](#13-ссылки)

---

# 1. Источник истины — объём и задача (Bart)

**ОБЪЁМ:**  
Экспериментирование с инструментом Еврокомиссии с открытым исходным кодом для редактирования, подписания и проверки доверенных списков. Комиссия опубликовала два инструмента: **Trusted List Manager** и **Trusted List Signing Tool**. **Manager** — основной и имеет **приоритет**.  
Цель — оценить сложность **развёртывания, размещения и сопровождения** этого инструмента как сервиса для **стран вне ЕС**.

**ЗАДАЧА:**  
- Попытаться **установить его и довести до рабочей конфигурации**.  
- Либо на **ВМ**, либо в контейнере **Podman**.  
- Предпочтительно на **Red Hat Linux** (корпоративный стандарт) или **дистрибутиве RHEL**.  
- **Оценить сложность доведения до готовности к продакшену.**

---

# 2. Инструменты в рамках проекта

## 2.1 Trusted List Manager (вне ЕС, приоритет)

- **Что это:** Веб-приложение для просмотра, редактирования и мониторинга доверенных списков. Предоставляется ЕК операторам доверенных списков.  
- **Статус:** В октябре 2025 объявлено, что Trusted List Manager **выводится из эксплуатации** для использования в ЕС; он больше не размещается и не сопровождается. Замена — **eIDAS Dashboard** (https://eidas.ec.europa.eu/efda/home). **Для стран вне ЕС по-прежнему используется**; недавно вышла **v6**.  
- **Руководство по эксплуатации (PDF):** ссылка ЕК ниже; **локальная копия:** `docs/TL-Manager(ServiceOfferingDescription) (v0.03).pdf`  
  https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/42358785/Trusted+List+Manager?preview=/42358785/52598139/TL-Manager(ServiceOfferingDescription)%20(v0.03).pdf  
  *(Этот SOD описывает назначение, пользователей, роли, процесс доступа; ОС и стек в нём не указаны — см. §5 по стеку из пакета развёртывания/других документов ЕК.)*  
- **Исходный код и пакет развёртывания (вне ЕС v6.0):**  
  https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/920062707/TL+manager+non-EU+v6.0  
  **В этом проекте:** `packages/TL-NEU-6.0.ZIP`  
- **Nexus (требуется вход; исходники/ZIP перечислены, загрузка может быть ограничена):**  
  - Просмотр: `https://ec.europa.eu/digital-building-blocks/artifact/#browse/browse:esignaturetlm:eu%2Feuropa%2Fec%2Fcef%2Fesignature%2FTL-NEU%2F6.0`  
  - ZIP: `.../TL-NEU-6.0.ZIP`

**Варианты подписания:**  
- **eIDAS USB-токены (QSCD)** — заказ через Riho: 6 устройств QSCD, сертифицированных по Common Criteria, напр. **Gemalto SafeNet eToken 5110 CC (940)** с QSCD.eu.  
- **Trusted List Signing Tool** (локальный) — подписание TL локально, затем загрузка/выгрузка подписанного/неподписанного XML через Manager:  
  https://ec.europa.eu/digital-building-blocks/artifact/#browse/browse:esignaturetlm:eu%2Feuropa%2Fec%2Fcef%2Fesignature%2FTLSigning%2F2.1  

## 2.2 Trusted List Signing Tool (вторичный)

- **Что это:** Небольшое локальное ПО цифровой подписи; создаёт подписи **XAdES** по **ETSI TS 119 612 v2.1.1–v2.4.1**; определяет версию доверенного списка и подписывает соответственно.  
- **Страница:** https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/924976410/Trusted+List+Signing+Tool  
- **Версия:** v2.1 (04/2025), соответствует спецификации TL v6.  
- **Загрузка:** Репозиторий в Nexus для ЕК; **требуется учётная запись** (Bart не нашёл, как её получить).  
- **Исходный код и инструкции по сборке:**  
  https://ec.europa.eu/digital-building-blocks/artifact/#browse/browse:esignaturetlm:eu%2Feuropa%2Fec%2Fcef%2Fesignature%2FTLSigning  

---

# 3. Предусловия и блокеры

| Пункт | Статус | Действие |
|-------|--------|----------|
| **Учётная запись Nexus / DBB** | Требуется **только для TL Signing Tool** (не для пакета TL Manager) | Запрашивать при развёртывании TL Signing Tool; пакет TL Manager может быть получен внутренне или через TLSO. |
| **ВМ или хост Red Hat / RHEL 9** | Обязательно | **RHEL 9 с самого начала** (Bart). Выделить RHEL 9 или Rocky Linux 9 / AlmaLinux 9. См. §4. |
| **Podman (опционально)** | Предпочтительно для воспроизводимости | Установить Podman на дистрибутив RHEL. |
| **Сеть** | Лабораторная/внутренняя | Обеспечить доступ хоста к URL ЕК для документации; без публичного доступа к приложению до утверждения. |

---

# 4. Заказ и поставка ресурсов

Заказывать **параллельно**, где возможно. Сроки ориентировочные; подстраивать под организацию.

| Ресурс | Спецификация / детали | Кому запрашивать | Срок (оценка) | Чек-лист |
|--------|------------------------|-------------------|---------------|----------|
| **ВМ (лаб.)** | 2 vCPU, 4 ГБ RAM, 20 ГБ диск; **RHEL 9** (или Rocky 9 / Alma 9); внутренняя/лаб. сеть | IT / инфраструктура или облачный портал | 3–10 дней | [ ] Заявка подана; [ ] Шаблон ОС выбран; [ ] Имя хоста зарезервировано (напр. `tl-manager-lab.internal`); [ ] Доступ по SSH-ключу или VPN подтверждён |
| **Учётная запись Nexus / DBB** | **Только для TL Signing Tool.** Доступ к репозиторию артефактов EC DBB (TL Signing). TL Manager (TL-NEU-6.0.ZIP) может быть из внутренних источников/TLSO. | Контакт EC TLSO или DBB при развёртывании Signing Tool | 1–4 нед. при необходимости | [ ] Контакт определён; [ ] Запрос отправлен; [ ] Учётные данные получены и сохранены в хранилище |
| **Внутренний DNS (опц.)** | A-запись для `tl-manager-lab.internal` (и напр. `cas-lab.internal`, если CAS на том же хосте) | Сеть / команда DNS | 1–3 дня | [ ] Имена запрошены; [ ] Запись создана |
| **SSL-сертификат (позже)** | Для продакшен-подобного HTTPS (внутренний УЦ или публичный); не нужен для начальной лабы | PKI / безопасность | 1–2 нед. при необходимости | [ ] Отложено до после PoC |
| **Резервное хранилище (позже)** | Квота для бэкапов БД и конфигов при переходе к продакшен-подобному режиму | IT / бэкапы | 1–2 нед. при необходимости | [ ] Отложено до после PoC |
| **eIDAS USB-токены (QSCD)** | Для теста совместимости подписания; QSCD, сертифицированный Common Criteria | **Попросить Riho заказать 6 устройств.** Использовать QSCD с сертификацией CC, напр. **Gemalto SafeNet eToken 5110 CC (940)** — QSCD.eu | По срокам закупки | [ ] Riho запрошен; [ ] Устройства получены; [ ] Драйверы и ридер работают |

**Готовый текст заявки на ВМ (для копирования):**

- **Назначение:** Лабораторное развёртывание EU Trusted List Manager (вне ЕС v6) для оценки.  
- **ОС:** **RHEL 9** (или Rocky Linux 9 / AlmaLinux 9).  
- **Ресурсы:** 2 vCPU, 4 ГБ RAM, 20 ГБ диск.  
- **Сеть:** Только внутренняя/лаб.; исходящий HTTPS к документации ЕК.  
- **Доступ:** SSH (по ключу); без входящего извне, кроме SSH при необходимости.  
- **Имя хоста:** `tl-manager-lab.internal` (или по корпоративной схеме имён).

---

# 5. Окружение и стек

**Официальный стек (от ЕК — Debian 12):**  
- OpenJDK **1.8**  
- Apache Tomcat **9.0.102**  
- MySQL **8.0.41**  
- Linux (Debian 12)

**Целевой стек в этом плане (Bart: RHEL 9 с самого начала):**  
- **ОС:** **RHEL 9** (или Rocky Linux 9 / AlmaLinux 9 как эквивалент RHEL)  
- **Java:** OpenJDK 8 (под требование приложения; пакет `java-1.8.0-openjdk` в RHEL)  
- **Сервер приложений:** Apache Tomcat 9.0.x (по возможности 9.0.102)  
- **БД:** MySQL 8.0.x (или MariaDB 10.6+, если допускается руководством)  
- **Аутентификация:** CAS (Apereo CAS) — SSO для входа оператора  
- **Развёртывание:** Одна ВМ **или** контейнеры Podman (Tomcat + MySQL + опционально CAS)

**CAS (Central Authentication Service):**  
- Apereo CAS: https://github.com/apereo/cas  
- Поддерживает CAS, SAML2, OIDC, OAuth2, MFA, LDAP и др.; развёртывается отдельным сервисом или контейнером; TL Manager настраивается на использование CAS как провайдера идентичности.

---

# 6. Детальный план с оценкой сроков

Оценки для одного исполнителя; **Фаза 0** может идти параллельно с заявкой на ВМ.

| Фаза | Описание | Оценка (дни) | Часы | Примечания |
|------|----------|--------------|------|------------|
| **0** | Снять блокировку: получить пакет TL Manager (внутренние каналы / TLSO; Nexus только для TL Signing Tool) | 1–3 д | 2–4 ч активной работы | Пакет TL Manager через внутренние каналы или TLSO; Nexus/DBB только для Signing Tool. |
| **1** | Подготовить базовую ВМ; закрепление ОС; SSH; фаервол; базовые пакеты | 0.5 д | 2–4 ч | Можно автоматизировать (Ansible/IaC). Срок выделения ВМ отдельно. |
| **2** | Установить OpenJDK 8, Tomcat 9, MySQL 8 (или MariaDB) на хост или в контейнеры | 0.5–1 д | 4–6 ч | Пакетный менеджер + конфиг или Podman Compose. |
| **3** | Развернуть и настроить CAS (минимальная конфигурация для TL Manager) | 1–2 д | 6–12 ч | CAS функционален; минимальная настройка под один сервис. |
| **4** | Развернуть WAR TL Manager; настроить БД, URL CAS, свойства приложения | 1 д | 4–6 ч | По руководству ЕК. |
| **5** | Дымовой тест: вход через CAS, открытие UI, создание/редактирование тестового TL | 0.5 д | 2–4 ч | Проверка сквозного сценария. |
| **6** | Опционально: тест совместимости подписания eIDAS USB-токеном (QSCD) | 0.5 д | 2–4 ч | Использовать Gemalto SafeNet eToken 5110 CC или аналог с QSCD.eu (заказ через Riho). |
| **7** | Документирование шагов; оценка готовности к продакшену (§11) | 0.5 д | 2–4 ч | Отчёт + чек-лист. |
| **Итого (ручная работа)** | | **~5–8 д** | **~24–44 ч** | Без учёта сроков выделения ВМ и закупок. |

**6.4 Выбор ОС (Bart):** **С самого начала использовать RHEL 9.**

**По календарю:** При сроках ВМ 5–10 дней (и Nexus только при развёртывании TL Signing Tool) закладывайте **2–5 недель** от первой заявки до работающей лаборатории (при условии получения пакета TL Manager в этом окне).

---

# 7. Риски и меры по снижению

| Риск | Вероятность | Влияние | Меры |
|------|-------------|---------|------|
| Учётная запись Nexus/DBB не выдана или задержана | Средняя | Блокер **только для TL Signing Tool** | Пакет TL Manager через внутренние каналы/TLSO; Nexus нужен только для Signing Tool. Запросить заранее, если Signing Tool потребуется. |
| TL Manager несовместим с RHEL/MySQL 8 / Tomcat 9.0.x | Низкая–средняя | Высокое | Держаться заявленных версий; при проблемах протестировать на Debian 12 в контейнере. |
| Настройка CAS сложнее ожидаемого | Средняя | Среднее | Заложить 2 дня на CAS; использовать минимальный overlay или готовый образ CAS; для лабы рассмотреть только «статический список пользователей». |
| OpenJDK 8 EOL / безопасность | Высокая (факт) | Среднее в долгосроке | Для PoC допустимо; для продакшена зафиксировать путь обновления или изоляцию. |
| ЕК прекращает поддержку TL Manager вне ЕС | Низкая (краткосрочно) | Высокое | Следить за анонсами ЕК; вне ЕС пока поддерживается; планировать переход на eIDAS Dashboard или иное при изменении политики ЕК. |
| ВМ или сеть не готовы в срок | Средняя | Сдвиг графика | Заказывать ВМ заранее; использовать локальный Podman на ноутбуке как запасной вариант для поднятия стека. (Nexus только при развёртывании TL Signing Tool.) |
| Нет TLS в лабе | Низкая | Низкое | Допустимо для внутренней лабы; зафиксировать TLS как требование для продакшена. |
| Потеря БД или конфигурации | Низкая | Среднее | Описать процедуру бэкапа в runbook; внедрить при переходе к продакшен-подобному режиму. |

---

# 8. Конкретные шаги (чек-лист)

## Фаза 0 — Снятие блокировки доступа к пакету

- [x] Получить пакет TL Manager вне ЕС v6.0 (ZIP или WAR) через внутреннюю передачу или TLSO (учётная запись Nexus/DBB нужна **только** для TL Signing Tool, не для TL Manager). **Выполнено: пакет в `packages/`.**
- [x] При необходимости: запрашивать учётную запись Nexus/DBB только при развёртывании TL Signing Tool; для TL Manager проверить, может ли ZetesConfidens или контакт ЕК предоставить `TL-NEU-6.0.ZIP` внутренне. **Не требуется — пакет получен.**
- [x] Скачать и сохранить пакет в защищённом месте проекта; проверить наличие WAR и/или инструкций по развёртыванию. **Выполнено: `packages/TL-NEU-6.0.ZIP`.**
- [ ] Зафиксировать место хранения пакета и контрольную сумму (напр. SHA-256) для воспроизводимости. *(Место: `packages/`; добавить контрольную сумму при необходимости.)*

## Фаза 1 — Базовая ВМ / хост

- [x] **Заказать ВМ** (см. §4): 2 vCPU, 4 ГБ RAM, 20 ГБ диск; **RHEL 9** (или Rocky Linux 9 / AlmaLinux 9). **Выполнено: лабораторная ВМ RHEL 9 поднята и доступна по SSH.**
- [x] Установить hostname (напр. `tl-manager-lab.internal`). **Сделано через Ansible (роль `base_server`).**
- [x] Настроить фаервол: разрешить SSH (22), HTTP/HTTPS (80/443) для Tomcat при необходимости; блокировать остальное извне. **Сделано через Ansible (`base_server`).**
- [x] Установить базовые пакеты: `podman` (при использовании контейнеров), `git`, `curl`, `wget`, `vim`. **Сделано (Java 8, git, curl, wget, vim установлены).**
- [x] Создать отдельного пользователя сервиса для запуска Tomcat (если не используются контейнеры). **Сделано: создан пользователь/группа `tomcat`.**
- [ ] Укрепить ОС: отключить лишние сервисы; по возможности перевести `sshd` только на ключи.

## Фаза 2 — Среда выполнения (выбрать A или B)

**Вариант A — Установка на хост (без контейнеров)**

- [x] Установить OpenJDK 8: `dnf install java-1.8.0-openjdk java-1.8.0-openjdk-devel`. **Сделано через Ansible (роль `base_server`).**
- [x] Скачать Apache Tomcat 9.0.102 (или последний 9.0.x) с зеркала Apache; распаковать в `/opt/tomcat` (или корпоративный путь). **Сделано через Ansible (роль `tomcat`, Tomcat в `/opt/tomcat`).**
- [x] Создать пользователя `tomcat`; задать `CATALINA_HOME`; выставить права. **Сделано через Ansible (`base_server` + `tomcat`).**
- [x] Установить MySQL 8.0: `dnf install mysql-server` (или подключить репозиторий MySQL и установить); запустить и включить `mysqld`. **Сделано через Ansible (роль `mysql`).**
- [x] Создать БД и пользователя для TL Manager (напр. `tlmanager` / пароль); выдать привилегии. **Сделано через Ansible (роль `mysql`, БД `tlmanager`).**
- [ ] Настроить Tomcat `server.xml` (порт коннектора 8080 или 8443); при необходимости добавить JAR коннектора MySQL в lib Tomcat.

**Вариант B — Podman**

- [ ] Написать `Dockerfile` или использовать образ Tomcat 9 + OpenJDK 8; образ MySQL 8.
- [ ] Создать `podman-compose.yml` или shell-скрипт: запуск контейнера MySQL, контейнера Tomcat; монтирование каталога развёртывания WAR или копирование WAR в образ.
- [ ] Создать БД и пользователя MySQL внутри контейнера (init-скрипт или вручную).
- [ ] Пробросить порт Tomcat (напр. 8080) на хост.

## Фаза 3 — CAS

- [ ] Развернуть Apereo CAS (напр. overlay с https://github.com/apereo/cas) как отдельный WAR или минимальный образ CAS в Docker.
- [ ] Настроить CAS на один сервис (callback URL TL Manager); минимальная аутентификация (напр. статический список пользователей или LDAP при наличии).
- [ ] Записать URL входа CAS и URL сервиса для конфигурации TL Manager.
- [ ] Проверить вход в CAS в браузере.

## Фаза 4 — Приложение TL Manager

- [x] Скопировать WAR TL Manager в `webapps/` Tomcat (напр. `webapps/ROOT.war` или `webapps/tlmanager.war`). **Сделано через Ansible (роль `tlmanager`, контекст `tl-manager-non-eu`).**
- [x] Создать конфигурацию приложения (по руководству ЕК): JDBC URL, пользователь БД, URL входа CAS, URL сервиса CAS, при необходимости пути к хранилищам доверия. **Сделано через Ansible (роль `tlmanager`, `application.properties` и `context.xml` с JDBC к БД `tlmanager`).**
- [x] **Keystore подписанта:** создать каталог, создать минимальный JKS через keytool (alias `tlmanager`, пароль `changeit`), выставить владельца `tomcat`, прописать в `application.properties` `signer.keystore.path` / `signer.keystore.password` и `keystore.path` / `keystore.password`. **Выполняется автоматически ролью `tlmanager`** — ручные шаги не требуются; см. [TL-Manager-Non-EU-Deployment.md](TL-Manager-Non-EU-Deployment.md).
- [x] Перезапустить Tomcat; проверить логи на ошибки запуска. **Tomcat перезапускается handler’ом; сервис `tomcat` работает.**
- [x] Открыть URL TL Manager в браузере; при необходимости выполнить первичную настройку приложения. **UI доступен по `http://tl-manager-lab.internal:8080/tl-manager-non-eu/`.**

## Фаза 5 — Валидация

- [ ] Войти в TL Manager через CAS (сценарий оператора).
- [ ] Создать или импортировать минимальный тестовый доверенный список (XML); отредактировать и сохранить.
- [ ] Убедиться в аудите/логировании действий оператора, если приложение это предусматривает.
- [ ] Задокументировать URL, роли по умолчанию и обнаруженные ограничения.

## Фаза 6 — Опциональное подписание

- [ ] **eIDAS USB-токены (QSCD):** Попросить Riho заказать **6 устройств**. Использовать продукт QSCD, сертифицированный по Common Criteria, напр. **Gemalto SafeNet eToken 5110 CC (940)** — QSCD.eu.
- [ ] Установить драйверы токена на рабочую станцию; в TL Manager проверить сценарий «подписать локальным устройством» или «загрузить подписанный XML»; зафиксировать результат (напр. «подписано, но не валидируется» без УЦ в хранилище доверия).

## Фаза 7 — Документация и оценка

- [ ] Написать внутренний документ: архитектура, порты, хранение учётных данных БД, бэкап БД и конфигурации.
- [ ] Заполнить оценку готовности к продакшену (§11); передать Bart.

---

# 9. Автоматизация где возможно

| Задача | Подход к автоматизации |
|--------|-------------------------|
| Выделение ВМ | Playbook Ansible или Terraform: создание ВМ, hostname, фаервол, базовые пакеты, `podman`. |
| OpenJDK + Tomcat + MySQL на хосте | Ansible: установка пакетов, распаковка Tomcat, создание БД и пользователя, развёртывание конфигов. |
| Стек Podman | `podman-compose` или shell: запуск MySQL, Tomcat; инициализация БД из SQL-файла. |
| Развёртывание CAS | Ansible или контейнер: развёртывание WAR CAS, минимальный `application.properties` (или YAML). |
| Конфигурация TL Manager | Шаблон Ansible или скрипт: запись `context.xml` / свойств приложения из переменных (URL БД, URL CAS). |
| Дымовой тест | Скрипт: `curl` страницы входа CAS, затем URL TL Manager; опционально Selenium/Playwright для входа в UI (LLM может сгенерировать скрипт по промпту). |

**Идея результата:** Один playbook Ansible (или Podman Compose + один init-скрипт), который: устанавливает OpenJDK 8, Tomcat 9, MySQL 8, разворачивает WAR и конфиг и при необходимости поднимает минимальный CAS — чтобы вручную оставалось только «получить WAR и задать переменные».

---

# 10. Промпты для LLM

Использовать как есть для генерации скриптов, конфигов или команд LLM/ассистентом. Считается Red Hat / Rocky Linux 9, если не указано иное.

**Промпт 1 — Базовый сервер**  
«Сгенерируй playbook Ansible для Rocky Linux 9, который: задаёт hostname tl-manager-lab; устанавливает podman, git, curl, wget, java-1.8.0-openjdk и firewalld; открывает SSH (22), HTTP (80) и HTTPS (443); создаёт пользователя tomcat без shell входа. Только dnf и стандартные модули.»

**Промпт 2 — Tomcat и MySQL на хосте**  
«Сгенерируй задачи Ansible для Rocky Linux 9: установить Apache Tomcat 9.0.102 из tarball в /opt/tomcat, запуск от пользователя tomcat, порт 8080; установить MySQL 8 server, создать БД tlmanager и пользователя tlmanager с паролем из переменной; добавить JAR коннектора MySQL в lib Tomcat. Только задачи, без обёртки playbook.»

**Промпт 3 — Стек Podman**  
«Напиши podman-compose.yml или shell-скрипт: запуск контейнера MySQL 8 с именованным томом и переменными MYSQL_DATABASE=tlmanager, MYSQL_USER и MYSQL_PASSWORD; запуск контейнера Tomcat 9 с OpenJDK 8 с монтированием каталога хоста для webapps, чтобы можно было положить WAR. Проброс порта Tomcat на хост 8080. Краткий README с командами start/stop.»

**Промпт 4 — Минимальный CAS**  
«Нужна минимальная конфигурация Apereo CAS 6.x для одного сервиса: ID сервиса «https://tl-manager-lab.internal/.*», URL сервера CAS https://cas-lab.internal/cas. Дай фрагменты application.yml (или properties) для in-memory реестра сервисов и одного статического пользователя (напр. admin/admin) для теста. Без LDAP и MFA.»

**Промпт 5 — Конфигурация TL Manager**  
«Trusted List Manager (EU EC, вне ЕС v6) работает на Tomcat и требует: JDBC URL MySQL jdbc:mysql://localhost:3306/tlmanager, пользователь tlmanager, пароль из env; URL входа CAS https://cas-lab.internal/cas/login; URL сервиса CAS https://tl-manager-lab.internal/. Куда это обычно прописывается в Java-приложении на Tomcat (context.xml, JNDI или application properties)? Дай конкретный пример для Tomcat 9.»

**Промпт 6 — Дымовой тест**  
«Напиши bash-скрипт: (1) curl -s -o /dev/null -w '%{http_code}' http://localhost:8080/ и ожидание 200 или 302; (2) curl страницы входа CAS и проверка на 200; (3) вывод PASS или FAIL. Только curl и стандартный shell. Без аутентификации в скрипте.»

---

# 11. Оценка готовности к продакшену

После получения рабочей конфигурации заполнить таблицу и добавить краткое описание для Bart.

| Критерий | Низкие / средние / высокие усилия | Примечания |
|----------|-----------------------------------|------------|
| Воспроизводимость развёртывания | | Ansible / Podman / вручную? |
| Жизненный цикл зависимостей | | OpenJDK 8 EOL; Tomcat 9; сопровождение MySQL 8. |
| Укрепление CAS | | Реальный IdP, TLS, MFA? |
| Резервное копирование и восстановление | | БД + конфиг + WAR. |
| Мониторинг и логирование | | Логи приложения, доступы, аудит. |
| Обновления безопасности | | Кто отслеживает CVE для Tomcat/MySQL/Java? |
| Документация и передача | | Runbook, хранилище учётных данных. |
| Риск вывода ЕК из эксплуатации (ЕС) | | Вне ЕС пока поддерживается; следить за анонсами ЕК. |
| **Настольное исследование: Azure или Amazon** | | Снизит ли развёртывание на **Azure или Amazon** усилия для production-ready окружения (бэкапы, HA)? Оценить в рамках оценки. |

**Результат:** Одностраничная «Оценка готовности к продакшену» с этой таблицей и 3–5 конкретными шагами перехода от «лабы» к «продакшен-подобному» (или рекомендация не выводить в продакшен).

---

# 12. Перспектива: после PoC и масштабирование

- **При успешном PoC:** Спланировать «продакшен-подобное» окружение: выделенные ВМ, TLS, реальный IdP (напр. корпоративный LDAP/OIDC), бэкапы, мониторинг и runbook. Рассмотреть отдельный экземпляр CAS и политику хранения бэкапов БД.
- **Соответствие:** Для операторов TL вне ЕС задокументировать соответствие развёртывания национальным или договорным требованиям (напр. eIDAS, аудит-логи).
- **Высокая доступность:** Текущий план — одна ВМ; для HA потребуются кластер Tomcat, репликация MySQL или управляемая БД и HA для CAS — описать как будущую опцию при росте спроса.
- **Дорожная карта ЕК:** Следить за eIDAS Dashboard и коммуникациями ЕК; при анонсе пути миграции для вне ЕС планировать переход с TL Manager на новый инструмент.
- **TL Signing Tool:** После получения доступа к Nexus добавить сборку/развёртывание TL Signing Tool (или зафиксировать сценарий «подписать на рабочей станции + загрузить» как поддерживаемый).

---

# 13. Ссылки

- **Брифинг Bart** — единственный источник истины (§1 этого документа).  
- **TL Manager (вне ЕС v6):**  
  https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/920062707/TL+manager+non-EU+v6.0  
- **Руководство по эксплуатации TL Manager (PDF):**  
  https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/42358785/Trusted+List+Manager?preview=/42358785/52598139/TL-Manager(ServiceOfferingDescription)%20(v0.03).pdf  
  **Локальная копия:** `docs/TL-Manager(ServiceOfferingDescription) (v0.03).pdf`  
- **TL Manager вне ЕС v6 — руководство по установке, миграции и использованию (PDF):**  
  **Локальная копия:** `docs/TLManager Non-EU - V6.0 - Installation, Migration & Utilisation guide 1.pdf`  
- **Развёртывание и автоматизация (этот репозиторий):** [docs/TL-Manager-Non-EU-Deployment.md](TL-Manager-Non-EU-Deployment.md) — что делает Ansible автоматически, keystore подписанта, ссылки на PDF.  
- **eIDAS Dashboard (замена в ЕС):** https://eidas.ec.europa.eu/efda/home  
- **eIDAS USB-токены (QSCD):** QSCD.eu — напр. **Gemalto SafeNet eToken 5110 CC (940)**; заказ 6 устройств через Riho.  
- **Trusted List Signing Tool:**  
  https://ec.europa.eu/digital-building-blocks/sites/spaces/TLSO/pages/924976410/Trusted+List+Signing+Tool  
- **Apereo CAS:** https://github.com/apereo/cas  

---

**Версия документа:** Черновик v4 — Bart: RHEL 9 с самого начала; Nexus только для TL Signing Tool; eIDAS USB-токены (QSCD, Riho); оценка готовности к продакшену + настольное исследование Azure/Amazon.  
**Комментарии приветствуются.**
